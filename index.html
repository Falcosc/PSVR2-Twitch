<!DOCTYPE html>
<html>
<title>PSVR2 Twitch Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-blue.css">
<style>
#lastError p {
	display: none;
}
#lastError p:nth-last-of-type(-n+3) {
	display: inherit;
}
form {
	width:340px;
}
</style>
<script type="text/javascript" src="scripts/tmi.js"></script>
<script type="text/javascript" src="scripts/main.js"></script>
<body class="w3-theme-d5" onload="loadSettings()">

	<div class="w3-theme-d4 w3-bar">
	<h2 class="w3-bar-item">PSVR2 Twitch Chat</h2>
	<a href="https://github.com/Falcosc/PSVR2-Twitch#Why-PSVR2" target="_blank" class="w3-bar-item w3-button w3-right w3-theme">What is this and why does it exist?</a>
	</div>

	<div class="w3-container w3-padding-large">
	<div class="w3-panel w3-red w3-display-container w3-small" id="lastError" style="display:none">
		<span onclick="this.parentElement.style.display='none'"class="w3-button w3-large w3-display-topright">&times;</span>
		<template id="errorLine">
			<p class="w3-tiny">
				<span class="w3-small"></span><br>
				<span style="white-space: pre" ></span>
			</p>
		</template>
	</div>
	<script>
	function displayError(source, lineno, colno, error, stack){
		const file = source.replace(/.*\//,'/').replace(/[?#].*/,'');
		const time = (new Date()).toLocaleTimeString();
		const errorLine = document.querySelector("#errorLine").content.cloneNode(true);
		let span = errorLine.querySelectorAll("span");
		span[0].textContent = `${time} ${file}:${lineno}:${colno} ${error}`;
		span[1].textContent = stack;
		document.querySelector("#lastError").appendChild(errorLine);
		document.querySelector("#lastError").style.display = 'block';
	}
	window.onerror = (event, source, lineno, colno, error) => {
		displayError(source, lineno, colno, error, error.stack);
	}
	window.addEventListener("unhandledrejection", (event) => {
		displayError(event.reason.fileName, event.reason.lineNumber, event.reason.columnNumber, event.reason.message, event.reason.stack);
	});
	</script>
	<div class="w3-panel w3-pale-yellow w3-border w3-small">
		<h1 class="w3-large">Paid Messages are not tested!</h1>
		<p>I am not sure if bits and sub messages do already work. But even if they do, currently they don't get priority and could get skipped on busy days like any normal chat message.</p>
	</div>

	<form id="connectionForm" class="w3-left w3-margin-right">
		<div>
			<label>Twitch Access Token</label>
			<div>
				<input class="w3-input" type="password" id="accessToken">
				<a href="https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=368mzno8zop311dlixwz4v7qvp0dgz&redirect_uri=https://falcosc.github.io/PSVR2-Twitch/&scope=chat:read&force_verify=true"
					class="w3-button w3-deep-purple" style="width:100%">Get Twitch Access Token</a>
			</div>
		</div>
		<p>
			<label>Twitch Bot Display Name</label>
			<input class="w3-input" type="text" id="displayName">
		</p>
		<p>
			<label>Stream/Channel to Monitor</label>
			<input class="w3-input" type="text" id="channel">
		</p>
		<p>
			<button class="w3-button w3-green" id="startBtn" disabled>Start</button>
			<button class="w3-button w3-red" id="stopBtn" disabled>Stop</button>
		</p>
	</form>

	<div class="w3-left w3-card-4 w3-margin-right w3-margin-bottom">
		<form id="statusVoice">
			<div class="w3-container w3-theme-d3">
				<h3>Stream/Channel Status Voice</h3>
			</div>
			<div class="w3-container">
				<p><label>Voice</label>
				<select class="w3-input w3-select" name="voice"></select></p>
				<p><label>Volume</label>
				<input class="w3-input" type="range" min="0" max="1" step="0.01" value="1" name="volume"></p>
				<p><label>Rate</label>
				<input class="w3-input" type="range" min="0.7" max="2" step="0.1" value="1" name="rate"></p>
				<p><label>Pitch</label>
				<input class="w3-input" type="range" min="0" max="2" step="0.1" value="1" name="pitch"></p>
			</div>
			<button class="w3-button w3-theme w3-block" type="submit" value="Submit" disabled>Test Status Voice</button>
		</form>
	</div>
	<div class="w3-left w3-card-4 w3-margin-right w3-margin-bottom">
		<form name="chatVoice">
			<div class="w3-container w3-theme-d3">
				<h3>Chat Message Voice</h3>
			</div>
			
			<div class="w3-container">
				<p><label>Voice</label>
				<select class="w3-input w3-select" name="voice"></select></p>
				<p><label>Volume</label>
				<input class="w3-input" type="range" min="0" max="1" step="0.01" value="1" name="volume"></p>
				<p><label>Rate</label>
				<input class="w3-input" type="range" min="0.7" max="2" step="0.1" value="1" name="rate"></p>
				<p><label>Pitch</label>
				<input class="w3-input" type="range" min="0" max="2" step="0.1" value="1" name="pitch"></p>
			</div>
			<button class="w3-button w3-theme w3-block" type="submit" value="Submit" disabled>Test Chat Voice</button>
		</form>
	</div>
</body>
</html>
